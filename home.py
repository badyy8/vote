import streamlit as st
import pandas as pd
from data_loader import load_data,get_contestants_df

df = load_data()
contestants = get_contestants_df()

st.title("СОНГУУЛИЙН САНАЛЫН ХУУДАСНЫ ДАТАСЕТ – ТОВЧ ТАЙЛАН")
st.caption("Descriptive & Methodology Overview | Нийслэлийн ба Дүүргийн сонгууль")

# ======================================================
# 1. Executive Summary
# ======================================================
st.markdown("""
## Товч хураангуй

Нэг мөр нь **нэг саналын хуудас**-ыг илэрхийлнэ.  
Саналын хуудас бүр дараах хоёр сонгуулийг агуулна:

- **нийслэлийн сонгууль:** 4 төлөөлөгч сонгоно  
- **Дүүргийн сонгууль:** 2 төлөөлөгч сонгоно  

Датасет нь сонгогчдын:
- намын тууштай сонголт
- намуудыг холих зан төлөв
- нэр дэвшигчдийн сонголтын холбоо
- хот–дүүргийн сонголтын уялдаа

зэрэг хэв шинжийг судлахад зориулагдав.

""")

# ======================================================
# 2. Dataset Overview
# ======================================================
with st.expander("Датасетийн ерөнхий мэдээлэл", expanded=True):

    st.subheader("Датасетийн бүтэц")

    col1, col2, col3 = st.columns(3)
    col1.metric("Нийт саналын хуудас", f"{len(df):,}")
    col2.metric("Нийт баганын тоо", df.shape[1])
    col3.metric("Өгөгдлийн эх сурвалж", "OCR-оор уншсан саналын хуудас")

    st.markdown("### Багануудын тайлбар")

    var_data = {
        "Баганын нэр": [
            "contest_city",
            "choice_1", "party_1",
            "choice_2", "party_2",
            "choice_3", "party_3",
            "choice_4", "party_4",
            "district_no",
            "district_candidate_1", "district_party_1",
            "district_candidate_2", "district_party_2",
        ],
        "Тайлбар": [
            "нийслэлийн сонгуулийн тайлбар",
            "нийслэлийн сонгууль – 1-р нэр дэвшигч", "1-р нэр дэвшигчийн нам",
            "нийслэлийн сонгууль – 2-р нэр дэвшигч", "2-р нэр дэвшигчийн нам",
            "нийслэлийн сонгууль – 3-р нэр дэвшигч", "3-р нэр дэвшигчийн нам",
            "нийслэлийн сонгууль – 4-р нэр дэвшигч", "4-р нэр дэвшигчийн нам",
            "Дүүргийн дугаар",
            "Дүүргийн сонгууль – 1-р нэр дэвшигч", "1-р нэр дэвшигчийн нам",
            "Дүүргийн сонгууль – 2-р нэр дэвшигч", "2-р нэр дэвшигчийн нам",
        ],
    }

    st.dataframe(
        pd.DataFrame(var_data),
        hide_index=True,
        use_container_width=True
    )

# ======================================================
# 3. Candidate Universe
# ======================================================
with st.expander("Нэр дэвшигчдийн орон зай (Candidate Universe)", expanded=False):

    st.markdown("""
        ### нийслэлийн сонгууль
        - **32 нэр дэвшигч**
        - **8 улс төрийн нам**
        - Сонгогч бүр **яг 4 нэр дэвшигч** сонгох ёстой           
    """)
    st.markdown("""
    ### Дүүргийн сонгууль
    - **140 нэр дэвшигч**
    - **9 улс төрийн нам**
    - Сонгогч бүр **яг 2 нэр дэвшигч** сонгох ёстой
""")
    st.dataframe(contestants.head(5),hide_index=True,use_container_width=True)
    


# ======================================================
# 4. Data Cleaning & Preparation
# ======================================================
with st.expander("Өгөгдөл цэвэрлэгээ ба боловсруулалт", expanded=False):

    st.markdown("""

### Хийгдсэн цэвэрлэгээ
- Нэр дэвшигчдийн нэрийг стандартчилсан
- Намын нэрийг баталгаажсан reference файлтай тулгасан
- нийслэлийн сонгуульд:
  - 4 нэр дэвшигч дутуу саналын хуудсыг ялгасан
- Дүүргийн сонгуульд:
  - 2 өөр нэр дэвшигч сонгосон эсэхийг шалгасан
- Дүүргийн дугаарыг текстээс задлан гаргасан

""")


# ======================================================
# 6. Preview
# ======================================================
with st.expander("Өгөгдлийн жишээ (Preview)", expanded=False):
    st.dataframe(df.head(20), use_container_width=True)
